// SPDX-License-Identifier: MIT
pragma solidity ^0.8.23;

import "forge-std/Script.sol";
import "../src/DarmaP2PLending.sol";
import "../src/DarmaCreditOracle.sol";

contract DeployP2PScript is Script {
    // Sepolia addresses
    address constant PYTH_SEPOLIA = 0x2880aB155794e7179c9eE2e38200202908C17B43;
    
    // Sepolia test tokens
    address constant USDC_SEPOLIA = 0x1c7D4B196Cb0C7B01d743Fbc6116a902379C7238;
    address constant DAI_SEPOLIA = 0xFF34B3d4Aee8ddCd6F9AFFFB6Fe49bD371b8a357;
    address constant WETH_SEPOLIA = 0xfFf9976782d46CC05630D1f6eBAb18b2324d6B14;

    function run() external {
        uint256 deployerPrivateKey = vm.envUint("PRIVATE_KEY");
        
        vm.startBroadcast(deployerPrivateKey);

        // First deploy the credit oracle if not already deployed
        DarmaCreditOracle creditOracle = new DarmaCreditOracle(PYTH_SEPOLIA);
        console.log("DarmaCreditOracle deployed at: %s", address(creditOracle));

        // Deploy P2P Lending contract
        DarmaP2PLending p2pLending = new DarmaP2PLending(address(creditOracle));
        console.log("DarmaP2PLending deployed at: %s", address(p2pLending));

        // Add supported tokens
        p2pLending.addSupportedToken(USDC_SEPOLIA);
        p2pLending.addSupportedToken(DAI_SEPOLIA);
        p2pLending.addSupportedToken(WETH_SEPOLIA);
        
        console.log("Added supported tokens:");
        console.log("  USDC: %s", USDC_SEPOLIA);
        console.log("  DAI: %s", DAI_SEPOLIA);
        console.log("  WETH: %s", WETH_SEPOLIA);

        vm.stopBroadcast();
    }
}